<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPI Check - Live DVLA Data</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-glow { transition: 0.3s; background: #38bdf8; }
        .btn-glow:hover { box-shadow: 0 0 15px #38bdf8; transform: scale(1.02); }
    </style>
</head>
<body class="flex flex-col items-center p-6">

    <div class="w-full max-w-md text-center mt-10">
        <h1 class="text-3xl font-bold text-sky-400 tracking-tighter">HPICHECK</h1>
        <p class="text-[10px] text-gray-500 uppercase tracking-widest mt-1">Official DVLA Data Access</p>
    </div>

    <!-- Search Section -->
    <div class="w-full max-w-md mt-8 space-y-4">
        <input id="regIn" type="text" placeholder="ENTER REG" class="w-full p-4 rounded-xl bg-slate-800 border border-slate-700 text-center text-2xl font-bold uppercase tracking-widest focus:outline-none focus:border-sky-500">
        <button onclick="fetchGovData()" class="w-full p-4 rounded-xl font-bold text-slate-900 btn-glow uppercase tracking-wider">Run Full History Scan</button>
    </div>

    <!-- Loading -->
    <div id="loading" class="hidden mt-10 text-center">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-sky-500 mx-auto"></div>
        <p class="text-xs text-gray-500 mt-4">Querying Secure Government Servers...</p>
    </div>

    <!-- Error Box -->
    <div id="errorBox" class="hidden w-full max-w-md mt-4 p-4 bg-red-500/10 border border-red-500/50 rounded-xl text-red-500 text-xs text-center"></div>

    <!-- Results -->
    <div id="report" class="hidden w-full max-w-md mt-8 space-y-4">
        <div class="glass p-6 rounded-3xl border-l-4 border-sky-500">
            <h2 id="resReg" class="text-4xl font-black">---</h2>
            <p id="resMake" class="text-sky-400 font-bold uppercase tracking-tight">--</p>
            
            <div class="grid grid-cols-2 gap-4 mt-8 text-sm">
                <div><p class="text-gray-500 text-[10px] uppercase">Tax Status</p><p id="resTax" class="font-bold">--</p></div>
                <div><p class="text-gray-500 text-[10px] uppercase">MOT Status</p><p id="resMOT" class="font-bold">--</p></div>
                <div><p class="text-gray-500 text-[10px] uppercase">Engine</p><p id="resEngine" class="font-bold">--</p></div>
                <div><p class="text-gray-500 text-[10px] uppercase">Colour</p><p id="resColor" class="font-bold">--</p></div>
                <div><p class="text-gray-500 text-[10px] uppercase">Fuel Type</p><p id="resFuel" class="font-bold">--</p></div>
                <div><p class="text-gray-500 text-[10px] uppercase">Year</p><p id="resYear" class="font-bold">--</p></div>
            </div>
        </div>
    </div>

    <script>
        async function fetchGovData() {
            const plate = document.getElementById('regIn').value.trim().toUpperCase();
            if (!plate) return alert("Please enter a registration");

            const load = document.getElementById('loading');
            const report = document.getElementById('report');
            const errorBox = document.getElementById('errorBox');

            // Reset UI
            load.style.display = "block";
            report.style.display = "none";
            errorBox.style.display = "none";

            try {
                // Using a proxy to bypass the "Load Failed" CORS error
                const proxyUrl = "https://api.allorigins.win/raw?url=";
                const targetUrl = "https://driver-vehicle-licensing.api.gov.uk/vehicle-enquiry/v1/vehicles";

                const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': 'pKb6MZppAVjFm2tpe5UP7BdFsEs1vzj5ZWnWWSic'
                    },
                    body: JSON.stringify({ registrationNumber: plate })
                });

                if (!response.ok) throw new Error("Vehicle not found or API limit reached.");

                const data = await response.json();

                // Fill UI
                document.getElementById('resReg').innerText = data.registrationNumber;
                document.getElementById('resMake').innerText = `${data.make} (${data.monthOfFirstRegistration})`;
                document.getElementById('resTax').innerText = data.taxStatus || "N/A";
                document.getElementById('resMOT').innerText = data.motStatus || "N/A";
                document.getElementById('resEngine').innerText = (data.engineCapacity || "0") + "cc";
                document.getElementById('resColor').innerText = data.colour || "N/A";
                document.getElementById('resFuel').innerText = data.fuelType || "N/A";
                document.getElementById('resYear').innerText = data.yearOfManufacture || "N/A";

                load.style.display = "none";
                report.style.display = "block";

            } catch (err) {
                load.style.display = "none";
                errorBox.style.display = "block";
                errorBox.innerText = err.message;
            }
        }
    </script>
</body>
</html>
