<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPI Check - Official Vehicle Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .btn-glow { transition: 0.3s; background: #38bdf8; }
        .btn-glow:hover { box-shadow: 0 0 15px #38bdf8; transform: scale(1.02); }
    </style>
</head>
<body class="flex flex-col items-center p-6">

    <div class="w-full max-w-md text-center mt-10">
        <h1 class="text-3xl font-bold tracking-tighter text-sky-400">HPICHECK</h1>
        <p class="text-xs text-gray-400 uppercase tracking-widest mt-1">Official Vehicle Data Verification</p>
    </div>

    <!-- Search Box -->
    <div class="w-full max-w-md mt-8 space-y-4">
        <input id="regIn" type="text" placeholder="ENTER REG" class="w-full p-4 rounded-lg bg-slate-800 border border-slate-700 text-center text-2xl font-bold uppercase tracking-widest focus:outline-none focus:border-sky-500">
        <button onclick="startDeepScan()" class="w-full p-4 rounded-lg font-bold text-slate-900 btn-glow uppercase tracking-wider">Run Full History Scan</button>
    </div>

    <!-- Status Messages -->
    <div id="loading-screen" class="hidden mt-10 text-center">
        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-sky-500 mx-auto"></div>
        <p class="text-sm text-gray-400 mt-4" id="status-text">Connecting to DVLA Database...</p>
        <p id="12" class="hidden text-xs text-sky-500 mt-2">Bypassing local firewalls...</p>
        <p id="13" class="hidden text-xs text-red-500 mt-2">Error connecting to live data. Check API Key!</p>
    </div>

    <!-- Result Report -->
    <div id="report" class="hidden w-full max-w-md mt-8 space-y-4">
        <div class="glass p-6 rounded-2xl">
            <h2 id="carName" class="text-4xl font-black text-white">---</h2>
            <p id="carSub" class="text-sky-400 font-medium">Vehicle Identified</p>
            
            <div class="grid grid-cols-2 gap-4 mt-6 text-sm">
                <div><p class="text-gray-500">Engine</p><p id="resEngine" class="font-bold">--</p></div>
                <div><p class="text-gray-500">Colour</p><p id="resColor" class="font-bold">--</p></div>
                <div><p class="text-gray-500">Fuel</p><p id="resFuel" class="font-bold">--</p></div>
                <div><p class="text-gray-500">Year</p><p id="resYear" class="font-bold">--</p></div>
                <div><p class="text-gray-500">Tax Status</p><p id="resTax" class="font-bold">--</p></div>
                <div><p class="text-gray-500">MOT Status</p><p id="resMOT" class="font-bold">--</p></div>
            </div>
        </div>

        <div class="glass p-6 rounded-2xl">
            <h3 class="text-sm font-bold uppercase text-gray-400 mb-4">Official Notices</h3>
            <p id="resULEZ" class="text-xs text-gray-300 italic">Check TfL website for ULEZ compliance.</p>
        </div>
    </div>

    <script>
        function delay(ms) { return new Promise(res => setTimeout(res, ms)); }

        async function startDeepScan() {
            const vrmInput = document.getElementById('regIn').value.trim().toUpperCase();
            const load = document.getElementById('loading-screen');
            const report = document.getElementById('report');
            const errorText = document.getElementById('13');

            if (!vrmInput) return alert("Please enter a registration.");

            // Reset view
            report.style.display = "none";
            load.style.display = "block";
            errorText.style.display = "none";
            document.getElementById('12').style.display = "none";

            try {
                await delay(800);
                document.getElementById('12').style.display = "block";

                const response = await fetch('https://driver-vehicle-licensing.api.gov.uk/vehicle-enquiry/v1/vehicles', {
                    method: 'POST',
                    headers: {
                        'content-type': 'application/json',
                        'x-api-key': 'pKb6MZppAVjFm2tpe5UP7BdFsEs1vzj5ZWnWWSic'
                    },
                    body: JSON.stringify({ registrationNumber: vrmInput })
                });

                if (!response.ok) {
                    throw new Error('Vehicle not found or API Key error');
                }

                const data = await response.json();
                
                await delay(1000); // Aesthetic delay for "Scanning" effect
                load.style.display = "none";
                report.style.display = "block";

                // Map Government data to HTML
                document.getElementById('carName').innerText = data.registrationNumber;
                document.getElementById('carSub').innerText = `${data.make} (First Reg: ${data.monthOfFirstRegistration})`;
                
                document.getElementById('resEngine').innerText = data.engineCapacity ? data.engineCapacity + "cc" : "N/A";
                document.getElementById('resColor').innerText = data.colour || "N/A";
                document.getElementById('resFuel').innerText = data.fuelType || "N/A";
                document.getElementById('resYear').innerText = data.yearOfManufacture || "N/A";
                document.getElementById('resTax').innerText = data.taxStatus || "N/A";
                document.getElementById('resMOT').innerText = data.motStatus || "N/A";

            } catch (error) {
                console.error(error);
                load.style.display = "block";
                errorText.style.display = "block";
                errorText.innerText = "Error: " + error.message;
            }
        }
    </script>
</body>
</html>
